<!DOCTYPE html>
<html>
<head>
    <title>Test Especificaciones T√©cnicas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .spec-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ Test de Especificaciones T√©cnicas</h1>
    <p>Verificando que los datos lleguen correctamente desde la API...</p>
    
    <div id="test-results"></div>
    
    <script>
        async function testProductSpecs() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<p>‚è≥ Cargando datos de la API...</p>';
            
            try {
                // Test 1: Cargar producto directamente de la API
                console.log('üîç Test 1: Cargando Voge 525 DSX desde API');
                const response = await fetch('/api/products/products/2/');
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const apiProduct = await response.json();
                console.log('üìä Datos crudos de la API:', apiProduct);
                
                let html = '<div class="spec-section">';
                html += '<h2 class="success">‚úÖ Test 1: API Response (Exitoso)</h2>';
                html += `<p><strong>Producto:</strong> ${apiProduct.name}</p>`;
                html += `<p><strong>Descripci√≥n:</strong> ${apiProduct.description ? 'S√≠ (' + apiProduct.description.length + ' caracteres)' : 'No disponible'}</p>`;
                html += `<p><strong>Features:</strong> ${apiProduct.features ? 'S√≠ (' + JSON.parse(apiProduct.features).length + ' items)' : 'No disponible'}</p>`;
                html += `<p><strong>Specs General:</strong> ${apiProduct.specs_general ? 'S√≠ (' + JSON.parse(apiProduct.specs_general).length + ' items)' : 'No disponible'}</p>`;
                html += `<p><strong>Specs Engine:</strong> ${apiProduct.specs_engine ? 'S√≠ (' + JSON.parse(apiProduct.specs_engine).length + ' items)' : 'No disponible'}</p>`;
                html += `<p><strong>Specs Comfort:</strong> ${apiProduct.specs_comfort ? 'S√≠ (' + JSON.parse(apiProduct.specs_comfort).length + ' items)' : 'No disponible'}</p>`;
                html += `<p><strong>Specs Safety:</strong> ${apiProduct.specs_safety ? 'S√≠ (' + JSON.parse(apiProduct.specs_safety).length + ' items)' : 'No disponible'}</p>`;
                html += '</div>';
                
                // Test 2: Transformar con la funci√≥n del products.js
                console.log('üîÑ Test 2: Transformando datos con funci√≥n del frontend');
                
                // Simular la funci√≥n transformProductFromAPI
                let specs = {};
                
                if (apiProduct.specs_general) {
                    specs.general = JSON.parse(apiProduct.specs_general);
                }
                if (apiProduct.specs_engine) {
                    specs.engine = JSON.parse(apiProduct.specs_engine);
                }
                if (apiProduct.specs_comfort) {
                    specs.comfort = JSON.parse(apiProduct.specs_comfort);
                }
                if (apiProduct.specs_safety) {
                    specs.safety = JSON.parse(apiProduct.specs_safety);
                }
                
                let features = apiProduct.features ? JSON.parse(apiProduct.features) : [];
                
                console.log('üìã Datos transformados:', { specs, features });
                
                html += '<div class="spec-section">';
                html += '<h2 class="success">‚úÖ Test 2: Transformaci√≥n (Exitoso)</h2>';
                html += `<p><strong>Features transformadas:</strong> ${features.length} items</p>`;
                html += `<p><strong>Specs.general:</strong> ${specs.general ? specs.general.length + ' items' : 'No disponible'}</p>`;
                html += `<p><strong>Specs.engine:</strong> ${specs.engine ? specs.engine.length + ' items' : 'No disponible'}</p>`;
                html += `<p><strong>Specs.comfort:</strong> ${specs.comfort ? specs.comfort.length + ' items' : 'No disponible'}</p>`;
                html += `<p><strong>Specs.safety:</strong> ${specs.safety ? specs.safety.length + ' items' : 'No disponible'}</p>`;
                html += '</div>';
                
                // Test 3: Mostrar datos reales
                html += '<div class="spec-section">';
                html += '<h2>üìä Test 3: Datos Detallados</h2>';
                
                if (features.length > 0) {
                    html += '<h3>Caracter√≠sticas:</h3><ul>';
                    features.slice(0, 3).forEach(feature => {
                        html += `<li>${feature}</li>`;
                    });
                    html += '</ul>';
                }
                
                if (specs.general && specs.general.length > 0) {
                    html += '<h3>Especificaciones Generales:</h3><ul>';
                    specs.general.slice(0, 3).forEach(spec => {
                        html += `<li><strong>${spec.label}:</strong> ${spec.value}</li>`;
                    });
                    html += '</ul>';
                }
                
                if (specs.engine && specs.engine.length > 0) {
                    html += '<h3>Especificaciones del Motor:</h3><ul>';
                    specs.engine.slice(0, 3).forEach(spec => {
                        html += `<li><strong>${spec.label}:</strong> ${spec.value}</li>`;
                    });
                    html += '</ul>';
                }
                
                html += '</div>';
                
                // Test 4: Datos JSON completos
                html += '<div class="spec-section">';
                html += '<h2>üîç Test 4: JSON Completo (para debugging)</h2>';
                html += '<h3>API Response:</h3>';
                html += `<pre>${JSON.stringify(apiProduct, null, 2)}</pre>`;
                html += '</div>';
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Error en el test:', error);
                resultsDiv.innerHTML = `
                    <div class="spec-section">
                        <h2 class="error">‚ùå Error en el Test</h2>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Revisa la consola del navegador para m√°s detalles.</p>
                    </div>
                `;
            }
        }
        
        // Ejecutar test al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', testProductSpecs);
    </script>
</body>
</html> 