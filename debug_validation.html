<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Validaci√≥n WhatsApp</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        input { width: 300px; padding: 10px; font-size: 16px; margin: 10px 0; }
        button { padding: 10px 20px; font-size: 16px; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico de Validaci√≥n WhatsApp</h1>
    
    <div class="test-case">
        <h3>Prueba en Tiempo Real</h3>
        <label for="phoneTest">N√∫mero de WhatsApp:</label><br>
        <input type="tel" id="phoneTest" placeholder="Ej: +52 1553974676, +58 4141234567">
        <button onclick="testValidation()">Probar Validaci√≥n</button>
        <div id="result" class="log"></div>
    </div>

    <div class="test-case">
        <h3>Pruebas Autom√°ticas</h3>
        <button onclick="runAllTests()">Ejecutar Todas las Pruebas</button>
        <div id="autoTests" class="log"></div>
    </div>

    <script>
        // Misma expresi√≥n regular del c√≥digo original
        const phonePattern = /^\+[1-9]\d{0,3}\s?\d{7,12}$/;

        function testValidation() {
            const input = document.getElementById('phoneTest');
            const result = document.getElementById('result');
            const value = input.value.trim();
            
            const isValid = phonePattern.test(value);
            const validityState = input.validity;
            
            result.innerHTML = `
                <strong>N√∫mero probado:</strong> "${value}"<br>
                <strong>Expresi√≥n regular:</strong> ${phonePattern}<br>
                <strong>Resultado regex:</strong> ${isValid ? '‚úÖ V√ÅLIDO' : '‚ùå INV√ÅLIDO'}<br>
                <strong>Validez HTML5:</strong> ${validityState.valid ? '‚úÖ V√ÅLIDO' : '‚ùå INV√ÅLIDO'}<br>
                <strong>Mensaje de validez:</strong> "${input.validationMessage}"<br>
                <strong>Estado personalizado:</strong> "${input.customValidity || 'Ninguno'}"
            `;
            
            result.className = isValid ? 'log success' : 'log error';
            
            // Aplicar la misma l√≥gica del c√≥digo original
            if (phonePattern.test(value) || value === '') {
                input.setCustomValidity('');
            } else {
                input.setCustomValidity('Formato inv√°lido. Ejemplo: +52 5539794679, +58 4141234567');
            }
        }

        function runAllTests() {
            const testCases = [
                '+521553974676',    // M√©xico (el que falla)
                '+52 1553974676',   // M√©xico con espacio
                '+584141234567',    // Venezuela
                '+58 4141234567',   // Venezuela con espacio
                '+1234567890',      // USA
                '+34612345678',     // Espa√±a
                '+5491234567',      // Argentina
                '1553974676',       // Sin +
                '+52155397467',     // M√©xico sin √∫ltimo d√≠gito
                '+5215539746761',   // M√©xico con d√≠gito extra
                '',                 // Vac√≠o
                '+58',              // Solo c√≥digo pa√≠s
                '+521',             // C√≥digo pa√≠s incompleto
            ];

            let output = '<h4>Resultados de todas las pruebas:</h4>';
            
            testCases.forEach(number => {
                const isValid = phonePattern.test(number);
                const status = isValid ? '‚úÖ' : '‚ùå';
                const analysis = analyzeNumber(number);
                
                output += `
                    <div style="margin: 5px 0; padding: 5px; background: ${isValid ? '#d4edda' : '#f8d7da'};">
                        ${status} <strong>"${number}"</strong> - ${analysis}
                    </div>
                `;
            });
            
            document.getElementById('autoTests').innerHTML = output;
        }

        function analyzeNumber(number) {
            if (!number) return 'Vac√≠o';
            
            if (!number.startsWith('+')) return 'No empieza con +';
            
            const withoutPlus = number.slice(1);
            const match = withoutPlus.match(/^([1-9])(\d{0,3})\s?(\d{7,12})$/);
            
            if (!match) {
                if (!/^[1-9]/.test(withoutPlus)) return 'No empieza con d√≠gito 1-9';
                if (withoutPlus.length < 8) return 'Muy corto';
                if (withoutPlus.length > 16) return 'Muy largo';
                return 'Formato incorrecto';
            }
            
            const [, firstDigit, countryRest, mainNumber] = match;
            const countryCode = firstDigit + countryRest;
            
            return `C√≥digo pa√≠s: ${countryCode} (${countryCode.length} d√≠gitos), N√∫mero: ${mainNumber} (${mainNumber.length} d√≠gitos)`;
        }

        // Prueba autom√°tica al cargar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Diagn√≥stico de validaci√≥n WhatsApp cargado');
            
            // Configurar evento de input en tiempo real
            const phoneInput = document.getElementById('phoneTest');
            phoneInput.addEventListener('input', function() {
                testValidation();
            });
        });
    </script>
</body>
</html> 